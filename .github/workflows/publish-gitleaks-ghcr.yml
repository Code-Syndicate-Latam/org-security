name: Publish Gitleaks Image to GHCR

on:
  workflow_dispatch:

permissions:
  contents: read
  packages: write

jobs:
  publish-gitleaks:
    name: Publish Gitleaks v8.21.2
    runs-on: ubuntu-latest

    steps:
      - name: Login to GHCR (Org Token)
        run: |
          echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin

      - name: Pull Gitleaks from Docker Hub
        run: |
          docker pull zricethezav/gitleaks:v8.21.2

      - name: Tag image for organization registry
        run: |
          docker tag zricethezav/gitleaks:v8.21.2 ghcr.io/Code-Syndicate-Latam/gitleaks:v8.21.2

      - name: Push image to GHCR
        run: |
          docker push ghcr.io/Code-Syndicate-Latam/gitleaks:v8.21.2

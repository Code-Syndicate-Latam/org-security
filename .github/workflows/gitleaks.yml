name: gitleaks-security-gate

on:
  workflow_call:

permissions:
  contents: read
  packages: read

jobs:
  scan-secrets:
    name: Gitleaks Security Scan
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: Code-Syndicate-Latam/checkout@v4.3.1

      - name: Run Gitleaks (blocking)
        run: |
          docker run \
            -v "${PWD}:/repo" \
            -w /repo \
            ghcr.io/code-syndicate-latam/gitleaks:v8.21.2 \
            detect \
            --no-git \
            --source . \
            --report-path gitleaks-report.json \
            --report-format json

      - name: Upload Gitleaks report
        if: always()
        uses: Code-Syndicate-Latam/upload-artifact@v4.6.2
        with:
          name: gitleaks-report
          path: gitleaks-report.json



